ggplot(coef_beta, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +
labs(x = NULL, y = "coefficient (RL baseline)", fill = NULL, title = "inverse temperature") +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
plot.title       = element_text(size = 18, face = "plain", hjust = 0.5),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10)
)
# Filter for inverse temperature only
coef_beta <- coef_all %>% filter(model == "inverse temperature")
ggplot(coef_beta, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +
labs(x = NULL, y = "coefficient (RL baseline)", fill = NULL, title = "inverse temperature") +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
plot.title       = element_text(size = 18, face = "plain", hjust = 0.5),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10)
)
library(scales)
ggplot(coef_beta, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +
labs(x = NULL, y = "coefficient (RL baseline)", fill = NULL, title = "inverse temperature") +
scale_fill_manual(values = fill_colors) +
scale_y_continuous(labels = scientific, expand = expansion(mult = c(0, 0.1))) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
plot.title       = element_text(size = 18, face = "plain", hjust = 0.5),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10)
)
View(coef_beta)
coef_beta <- coef_beta %>%
mutate(
Estimate = Estimate * 1e6,
conf.low = conf.low * 1e6,
conf.high = conf.high * 1e6,
y = y * 1e6
)
ggplot(coef_beta, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +
labs(
x = NULL,
y = expression("coefficient ("*10^{-6}*")"),
fill = NULL,
title = "inverse temperature"
) +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
plot.title       = element_text(size = 18, face = "plain", hjust = 0.5),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10)
)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(car)
library(lme4)
library(lmerTest)
library(Matrix)
library(tidyr)
library(readxl)
library(ggpubr)
library(interactions)
library(performance) #checking model performance
library(margins)
library(tibble) #plot
library(ggplot2) #plot
#rm(list = ls())
ug_data = read.csv("../data/LEAP_baseline_ug_n236_analysis.csv")
ug_model= read.csv("../ug_modeling/baseline_fit/UG_fit_RWvarf0_May25.csv")
rl_data = read.csv("../data/LEAP_baseline_rl_n220_analysis.csv")
rl_model= read.csv("../rl_modeling/baseline_fit/RL_fit_RW_valence_T1_May25.csv")
ug_data = var_recode(ug_data)
rl_data = var_recode(rl_data)
rl_data$block_type_recode = factor(rl_data$block_type, levels= c("numberbar_mixed","numberbar_pos","numberbar_neg"),labels=c("Mixed","Positive","Negative"))
print('UG RT')
summary(ug_data$choice_rt)
print('Slot RT')
summary(rl_data$rt)
# mean centering for main effect
ug_model$depression_mc = ug_model$depression - mean(ug_model$depression)
ug_model$anhedonia_mc = ug_model$anhedonia - mean(ug_model$anhedonia)
ug.envy <- lm(data = ug_model,
formula = envy ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
summary(ug.envy)
confint(ug.envy)
performance(ug.envy)
ug.lr <- lm(data = ug_model,
formula = beta ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
ug.lr <- lm(data = ug_model,
formula = lr ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
summary(ug.lr)
confint(ug.lr)
performance(ug.lr)
ug.f0 <- lm(data = ug_model,
formula = f0 ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
summary(ug.f0)
confint(ug.f0)
performance(ug.f0)
coef_all <- bind_rows(
extract_coefs(ug.f0, "f0"),
extract_coefs(ug.envy, "envy"),
extract_coefs(ug.lr, "alpha")
)
# Factor ordering
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "anhedonia", "interaction")),
model = factor(model, levels = c("f0", "envy", "alpha"))
)
# Compute fixed star heights per model
y_star_pos <- coef_all %>%
group_by(model) %>%
summarise(y = max(conf.high) + 0.1)
coef_all <- left_join(coef_all, y_star_pos, by = "model")
# Custom fill colors (Pride flag–inspired)
fill_colors <- c(
"depression" = "#abb9f5",
"interaction" = "#5D77EC",
"anhedonia" = "#193CD6"
)
# Custom facet labels
facet_labels <- c(
f0 = "initial norm",
envy = "norm aversion",
lr = "norm update"
)
# Ensure custom bar order
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "interaction", "anhedonia")),
model = factor(model, levels = c("f0", "envy", "lr"))
)
ggplot(coef_all, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +  # skinnier bars, less space
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +  # bigger stars
facet_wrap(~model, labeller = as_labeller(facet_labels), nrow = 1) +    # force 1 row
labs(x = NULL, y = "coefficient (UG baseline)", fill = NULL) +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +  # increase base font size
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
strip.text       = element_text(size = 18, face = "plain"),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10),  # tighter margins
strip.placement  = "outside",              # put facet labels outside panels
panel.spacing    = unit(0.8, "lines")      # reduce spacing between panels
)
# Custom fill colors (Pride flag–inspired)
fill_colors <- c(
"depression" = "#abb9f5",
"interaction" = "#5D77EC",
"anhedonia" = "#193CD6"
)
# Custom facet labels
facet_labels <- c(
f0 = "initial norm",
envy = "norm aversion",
alpha = "norm update"
)
# Ensure custom bar order
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "interaction", "anhedonia")),
model = factor(model, levels = c("f0", "envy", "alpha"))
)
ggplot(coef_all, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +  # skinnier bars, less space
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +  # bigger stars
facet_wrap(~model, labeller = as_labeller(facet_labels), nrow = 1) +    # force 1 row
labs(x = NULL, y = "coefficient (UG baseline)", fill = NULL) +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +  # increase base font size
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
strip.text       = element_text(size = 18, face = "plain"),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10),  # tighter margins
strip.placement  = "outside",              # put facet labels outside panels
panel.spacing    = unit(0.8, "lines")      # reduce spacing between panels
)
coef_all <- bind_rows(
extract_coefs(ug.f0, "f0"),
extract_coefs(ug.envy, "envy"),
extract_coefs(ug.lr, "alpha")
)
# Factor ordering
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "anhedonia", "interaction")),
model = factor(model, levels = c("f0", "envy", "alpha"))
)
# Compute fixed star heights per model
y_star_pos <- coef_all %>%
group_by(model) %>%
summarise(y = max(conf.high) + 0.1)
coef_all <- left_join(coef_all, y_star_pos, by = "model")
# Custom fill colors (Pride flag–inspired)
fill_colors <- c(
"depression" = "#abb9f5",
"interaction" = "#5D77EC",
"anhedonia" = "#193CD6"
)
# Custom facet labels
facet_labels <- c(
f0 = "initial norm",
envy = "norm aversion",
alpha = "norm update"
)
# Ensure custom bar order
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "interaction", "anhedonia")),
model = factor(model, levels = c("f0", "envy", "alpha"))
)
ggplot(coef_all, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +  # skinnier bars, less space
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +  # bigger stars
facet_wrap(~model, labeller = as_labeller(facet_labels), nrow = 1) +    # force 1 row
labs(x = NULL, y = "coefficient (UG baseline)", fill = NULL) +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +  # increase base font size
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
strip.text       = element_text(size = 18, face = "plain"),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10),  # tighter margins
strip.placement  = "outside",              # put facet labels outside panels
panel.spacing    = unit(0.8, "lines")      # reduce spacing between panels
)
ggsave(
filename = "./figure/ug_param_effect_T1_varf0.jpg",
plot = last_plot(),      # or specify your plot object name if assigned
width = 14,               # adjust as needed
height = 6,              # adjust as needed
dpi = 300,
units = "in"
)
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(car)
library(lme4)
library(lmerTest)
library(Matrix)
library(tidyr)
library(readxl)
library(ggpubr)
library(interactions)
library(performance) #checking model performance
library(margins)
library(tibble) #plot
library(ggplot2) #plot
#rm(list = ls())
# Z-score
normalize = function(x) {
return ((x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE))
}
# Function to recode variables
var_recode = function(data){
data$age_z <- normalize(data$age)
data$edu_z <- normalize(data$edu_level)
data$income_z <- normalize(data$income_order)
data$ses <- data$edu_z + data$income_z
data$poc <- ifelse(data$race == "White", 0, 1) # POC coded as 1
data$poc <- factor(data$poc)
data$female <- ifelse(data$sex == 2, 1, 0)  # Female=1, Male+Other=0
#data$female <- ifelse(data$sex == 2, 1,
#ifelse(data$sex == 3, NA, 0)) # Female coded as 1, Other as NA, Male as 0, row 150
data$female = factor(data$female)
data$group = factor(data$group, levels = c("Healthy", "Depression", "Anhedonia", "Both"))
# mean centering for main effect
data$depression_mc = data$depression - mean(data$depression)
data$anhedonia_mc = data$anhedonia - mean(data$anhedonia)
# raw score
data$pvss_reversed <- -data$pvss_total
data$bdi_total_z <- scale(data$bdi_total)
data$pvss_total_z <- scale(data$pvss_reversed)
return(data)
}
# Function to extract coefficients from a model
extract_coefs <- function(model, model_name) {
coefs <- summary(model)$coefficients
as.data.frame(coefs) %>%
rownames_to_column("term") %>%
filter(term %in% c("depression_mc", "anhedonia_mc", "depression_mc:anhedonia_mc")) %>%
mutate(
conf.low = Estimate - `Std. Error`,
conf.high = Estimate + `Std. Error`,
term_clean = case_when(
term == "depression_mc" ~ "depression",
term == "anhedonia_mc" ~ "anhedonia",
term == "depression_mc:anhedonia_mc" ~ "interaction"
),
model = model_name,
sig_label = case_when(
`Pr(>|t|)` < 0.001 ~ "***",
`Pr(>|t|)` < 0.01  ~ "**",
`Pr(>|t|)` < 0.05  ~ "*",
TRUE ~ ""
)
) %>%
select(model, term_clean, Estimate, `Std. Error`, conf.low, conf.high, sig_label)
}
# save stats results
save_model_to_excel <- function(model, filename, include_random = TRUE) {
library(openxlsx)
# Extract fixed effects
summary_df <- data.frame(
Variable = rownames(summary(model)$coefficients),
summary(model)$coefficients,
row.names = NULL
)
# Start with list containing fixed effects
output_list <- list(Fixed = summary_df)
# Optionally add random effects
if (include_random) {
random_df <- as.data.frame(VarCorr(model))
output_list$Random <- random_df
}
# Save to Excel
write.xlsx(output_list, file = filename, rowNames = FALSE)
}
ug_data_t3 = read.csv("../data/LEAP_month1_ug_n129_analysis.csv")
ug_model_t3= read.csv("../ug_modeling/month1_fit/UG_fit_RWvarf0_T3_May25.csv")
rl_data_t3 = read.csv('../data/LEAP_month1_rl_n125_analysis.csv')
rl_model_t3= read.csv("../rl_modeling/month1_fit/RL_fit_RW_context_T3_May25.csv")
ug_data_t3 = var_recode(ug_data_t3)
rl_data_t3 = var_recode(rl_data_t3)
rl_data_t3$block_type_recode = factor(rl_data_t3$block_type, levels= c("numberbar_mixed","numberbar_pos","numberbar_neg"),labels=c("Mixed","Positive","Negative"))
print('UG RT')
summary(ug_data_t3$choice_rt)
print('Slot RT')
summary(rl_data_t3$rt)
# mean centering for main effect
ug_model_t3$depression_mc = ug_model_t3$depression - mean(ug_model_t3$depression)
ug_model_t3$anhedonia_mc = ug_model_t3$anhedonia - mean(ug_model_t3$anhedonia)
ug.envy.t3 <- lm(data = ug_model_t3,
formula = envy ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
summary(ug.envy.t3)
confint(ug.envy.t3)
performance(ug.envy.t3)
ug.lr.t3 <- lm(data = ug_model_t3,
formula = lr ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
summary(ug.lr.t3)
confint(ug.lr.t3)
performance(ug.lr.t3)
ug.f0.t3 <- lm(data = ug_model_t3,
formula = f0 ~ depression_mc + anhedonia_mc + depression_mc*anhedonia_mc)
summary(ug.f0.t3)
confint(ug.f0.t3)
performance(ug.f0.t3)
coef_all <- bind_rows(
extract_coefs(ug.envy.t3, "envy"),
extract_coefs(ug.lr.t3, "alpha"),
extract_coefs(ug.f0.t3, "f0")
)
# Factor ordering
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "anhedonia", "interaction")),
model = factor(model, levels = c("envy", "alpha", "f0"))
)
# Compute fixed star heights per model
y_star_pos <- coef_all %>%
group_by(model) %>%
summarise(y = max(conf.high) + 0.1)
coef_all <- left_join(coef_all, y_star_pos, by = "model")
# Custom fill colors (Pride flag–inspired)
fill_colors <- c(
"depression" = "#5BCEFA",                   # Light blue
"interaction" = "#B388EB",                  # Soft purple
"anhedonia" = "#F5A9B8"                     # Light pink
)
# Custom facet labels
facet_labels <- c(
envy = "norm aversion",
alpha = "norm update",
f0 = "initial norm"
)
# Ensure custom bar order
coef_all <- coef_all %>%
mutate(
term_clean = factor(term_clean, levels = c("depression", "interaction", "anhedonia")),
model = factor(model, levels = c("envy", "alpha", "f0"))
)
ggplot(coef_all, aes(x = term_clean, y = Estimate, fill = term_clean)) +
geom_bar(stat = "identity", width = 0.55) +  # skinnier bars, less space
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.1) +
geom_text(aes(y = y, label = sig_label), size = 10, color = "black") +  # bigger stars
facet_wrap(~model, labeller = as_labeller(facet_labels), nrow = 1) +    # force 1 row
labs(x = NULL, y = "coefficient (1-month)", fill = NULL) +
scale_fill_manual(values = fill_colors) +
coord_cartesian(clip = "off") +
theme_minimal(base_size = 18) +  # increase base font size
theme(
panel.grid       = element_blank(),
axis.text.x      = element_blank(),
axis.ticks.x     = element_blank(),
axis.text.y      = element_text(size = 16),
axis.title.y     = element_text(size = 18, margin = margin(r = 10)),
strip.text       = element_text(size = 18, face = "plain"),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.justification = "center",
legend.box       = "horizontal",
legend.text      = element_text(size = 16),
plot.margin      = margin(10, 10, 10, 10),  # tighter margins
strip.placement  = "outside",              # put facet labels outside panels
panel.spacing    = unit(0.8, "lines")      # reduce spacing between panels
)
ggsave(
filename = "./figure/ug_param_effect_T3_varf0.jpg",
plot = last_plot(),      # or specify your plot object name if assigned
width = 14,              # adjust as needed
height = 6,              # adjust as needed
dpi = 300,
units = "in"
)
save_model_to_excel(ug.rt, "../lme_results/ug_T1/ug_rt.xlsx", include_random = TRUE)
save_model_to_excel(ug.rr, "../lme_results/ug_T1/ug_rr.xlsx", include_random = TRUE)
save_model_to_excel(ug.md, "../lme_results/ug_T1/ug_md.xlsx", include_random = TRUE)
save_model_to_excel(ug.envy, "../lme_results/ug_T1/ug_envy.xlsx", include_random = FALSE)
save_model_to_excel(ug.lr, "../lme_results/ug_T1/ug_alpha.xlsx", include_random = FALSE)
save_model_to_excel(ug.f0, "../lme_results/ug_T1/ug_f0.xlsx", include_random = FALSE)
save_model_to_excel(ug.rt.t3, "../lme_results/ug_T3/ug_rt.xlsx", include_random = TRUE)
save_model_to_excel(ug.rr.t3, "../lme_results/ug_T3/ug_rr.xlsx", include_random = TRUE)
save_model_to_excel(ug.md.t3, "../lme_results/ug_T3/ug_md.xlsx", include_random = TRUE)
save_model_to_excel(ug.envy.t3, "../lme_results/ug_T3/ug_envy.xlsx", include_random = FALSE)
save_model_to_excel(ug.lr.t3, "../lme_results/ug_T3/ug_alpha.xlsx", include_random = FALSE)
save_model_to_excel(ug.f0.t3, "../lme_results/ug_T3/ug_f0.xlsx", include_random = FALSE)
